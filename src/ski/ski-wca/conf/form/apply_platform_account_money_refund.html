<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=0'/>
        <title>退款</title>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/style/weui.min.css'/>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/example/example.css'/>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery-3.0.0.min.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery.json.min.js'></script>
        <script type='text/javascript' src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>
        <script type='text/javascript'>
            var inst            = '%x';
            var user            = '%x';
            var refund_user     = '%s';
            var refund_name     = '%s';
            var refund_money    = '%.2f';
            var base            = '/ski-wcweb/pay/refund?inst=' + inst + '&user=' + user;

            $(document).ready(function() {
                $('#refund_user').val(refund_user);
                $('#refund_name').val(refund_name);
                $('#refund_money').text(refund_money);
            });

            function submit() {
                showToast('正在处理');
                $.post(base, $.toJSON({
                            'step'      : 'apply',
                            '_user'     : $('#refund_user').val(),
                            '_name'     : $('#refund_name').val(),
                            '_money'    : $('#refund_money').text()
                        }), function(args) {
                            hideToast();
                            if (0 == args.code) {
                            } else {
                                showDialog("退款失败", args.desc);
                            }
                        });
            }

            function showToast(text) {
                $('#toast_text').text(text);
                $('#toast').show();
            }
            function hideToast() {
                $('#toast').hide();
            }

            function showDialog(head, body) {
                $('#result_head').text(head);
                $('#result_body').text(body);
                $('#dialog').show();
            }
        </script>
    </head>
    <body>
        <div class='cell'>
            <div class='hd'>
                <h1 class='page_title'>退款</h1>
            </div>
            <div class='bd'>
                <div class='weui_cells_title'>只能退“现金”部分的金额</div>
                <div class='weui_cells'>
                    <div class="weui_cell">
                        <div class="weui_cell_hd"><label class="weui_label">支付宝账号</label></div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <input class="weui_input" id='refund_user' placeholder="退款支付宝账号">
                        </div>
                    </div>
                    <div class="weui_cell">
                        <div class="weui_cell_hd"><label class="weui_label">真实姓名</label></div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <input class="weui_input" id='refund_name' placeholder="支付宝账号注册姓名">
                        </div>
                    </div>
                    <div class="weui_cell">
                        <div class="weui_cell_bd weui_cell_primary">
                            <p>退款金额</p>
                        </div>
                        <div class="weui_cell_ft" id='refund_money'></div>
                    </div>
                </div>
                <div class='weui_btn_area'>
                    <a class='weui_btn weui_btn_primary' href="javascript:submit()">退款</a>
                </div>
            </div>
        </div>
        <div class="weui_dialog_alert" id="dialog" style='display:none'>
            <div class="weui_mask"></div>
            <div class="weui_dialog">
                <div class="weui_dialog_hd"><strong class="weui_dialog_title" id='result_head'></strong></div>
                <div class="weui_dialog_bd" id='result_body'></div>
                <div class="weui_dialog_ft">
                    <a class="weui_btn_dialog primary" href="javascript:$('#dialog').hide();">确定</a>
                </div>
            </div>
        </div>
        <div class="weui_loading_toast" id="toast" style="display: none;">
            <div class="weui_mask_transparent"></div>
            <div class="weui_toast">
                <div class="weui_loading">
                    <div class="weui_loading_leaf weui_loading_leaf_0"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_1"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_2"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_3"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_4"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_5"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_6"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_7"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_8"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_9"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_10"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_11"></div>
                </div>
                <p class="weui_toast_content" id='toast_text'></p>
            </div>
        </div>
    </body>
</html>
