<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=0'/>
        <title>搜索游戏</title>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/style/weui.min.css'/>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/example/example.css'/>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery-3.0.0.min.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery.json.min.js'></script>
        <script type='text/javascript' src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>
        <style type="text/css">
        td {
            white-space     : nowrap;
        }
        .rent_enable {
            text-align      : center;
            font-size       : 10px;
            color           : white;
            background      : #00C802;
            -webkit-border-radius   : 6px;
            -moz-border-radius      : 6px;
        }
        .rent_disable {
            text-align      : center;
            font-size       : 10px;
            color           : white;
            background      : #B2B2B2;
            -webkit-border-radius   : 6px;
            -moz-border-radius      : 6px;
        }
        </style>
        <script type='text/javascript'>
            var user = %d;
            var url_setup = '/ski-wcweb?inst=2001&user=' + user.toString(16) + '&step=setup';
            var url_detail = '/ski-wcweb?inst=2001&user=' + user.toString(16);

            $(document).ready(function() {
                setup();
            });

            function preset() {
                $.post(url_setup, $.toJSON({
                            'tag'  : '预置'
                        }), function(args) {

                            var title = document.createElement('div');
                            title.setAttribute('class', 'weui_panel_hd');
                            title.innerText = '热门游戏';

                            var cells = document.createElement('div');
                            cells.setAttribute('class', 'weui_panel_bd');
                            for (var i in args.desc) {
                                var game = args.desc[i];
                                var cell = "<a class='weui_media_box weui_media_appmsg' href=\"javascript:browseGame(" + game.gid + ");\">"
                                             + "<div class='weui_media_hd'><img class='weui_media_appmsg_thumb' src='" + game.url_icon + "'></div>"
                                             + "<div class='weui_media_bd'>"
                                                + "<h4 class='weui_media_title'>" + game.name_zh_cn + "</h4>"
                                                + "<p class='weui_media_desc'>" + game.introduction + "</p>"
                                             + "</div>"
                                             + "<div style='position: absolute; width: 80px; top: 20px; right: 20px'><table width='100%%'><tr>"
                                                 + "<td><div class='" + (game.rent_a ? "rent_enable" : "rent_disable") + "'>认证</div></td>"
                                                 + "<td><div class='" + (game.rent_b ? "rent_enable" : "rent_disable") + "'>不认证</div></td>"
                                             + "</tr></table></div>"
                                         + "</a>";
                                cells.innerHTML = cells.innerHTML + cell;
                            }
                            $('#result')[0].innerHTML = '';
                            $('#result')[0].appendChild(title);
                            $('#result')[0].appendChild(cells);
                        });
            }

            function search(word) {
                showToast('正在搜索');
                $.post(url_setup, $.toJSON({
                            'word'  : word
                        }), function(args) {
                            hideToast();
                            if (0 != args.code) {
                                showDialog("搜索失败", args.desc);
                                return;
                            }
                            var title = document.createElement('div');
                            title.setAttribute('class', 'weui_panel_hd');
                            title.innerText = '搜索结果';

                            var cells = document.createElement('div');
                            cells.setAttribute('class', 'weui_panel_bd');
                            for (var i in args.desc) {
                                var game = args.desc[i];
                                var cell = "<a class='weui_media_box weui_media_appmsg' href=\"javascript:browseGame(" + game.gid + ");\">"
                                             + "<div class='weui_media_hd'><img class='weui_media_appmsg_thumb' src='" + game.url_icon + "'></div>"
                                             + "<div class='weui_media_bd'>"
                                                + "<h4 class='weui_media_title'>" + game.name_zh_cn + "</h4>"
                                                + "<p class='weui_media_desc'>" + game.introduction + "</p>"
                                             + "</div>"
                                             + "<div style='position: absolute; width: 80px; top: 20px; right: 20px'><table width='100%%'><tr>"
                                                 + "<td><div class='" + (game.rent_a ? "rent_enable" : "rent_disable") + "'>认证</div></td>"
                                                 + "<td><div class='" + (game.rent_b ? "rent_enable" : "rent_disable") + "'>不认证</div></td>"
                                             + "</tr></table></div>"
                                         + "</a>";
                                cells.innerHTML = cells.innerHTML + cell;
                            }
                            $('#result')[0].innerHTML = '';
                            $('#result')[0].appendChild(title);
                            $('#result')[0].appendChild(cells);
                        });
            }

            function setup() {
                var word   = $('#search_input').val().replace(/(^\s*)|(\s*$)/g, "");

                if (0 == word.length) {
                    preset();
                } else {
                    search(word);
                }

            }

            function browseGame(gid) {
                window.location = url_detail + '&gid=' + gid.toString(16);
            }

            function showToast(text) {
                $('#toast_text').text(text);
                $('#toast').show();
            }
            function hideToast() {
                $('#toast').hide();
            }

            function showDialog(head, body) {
                $('#result_head').text(head);
                $('#result_body').text(body);
                $('#dialog').show();
            }
        </script>
    </head>
    <body>
        <div class='panel'>
            <div class='bd'>
                <div class="weui_search_bar" id="search_bar">
                    <div class="weui_search_outer">
                        <div class="weui_search_inner">
                            <i class="weui_icon_search"></i>
                            <input class="weui_search_input" id="search_input" required="" type="search" placeholder="搜索" onkeyup="if(13 == event.keyCode) setup();" onfocus="$('#search_bar').addClass('weui_search_focusing');" onblur="if (0 == $('#search_input').val().length) $('#search_bar').removeClass('weui_search_focusing');">
                            <a class="weui_icon_clear" id="search_clear" href="javascript:$('#search_input').val('');$('#search_input').focus();setup();"></a>
                        </div>
                        <label class="weui_search_text" id="search_text" for="search_input">
                            <i class="weui_icon_search"></i>
                            <span>搜索</span>
                        </label>
                    </div>
                    <a class="weui_search_cancel" id="search_cancel" href="javascript:$('#search_input').val('');$('#search_input').blur();setup();">取消</a>
                </div>
                <div class="weui_panel weui_panel_access" id='result'>
                </div>
            </div>
        </div>
        <div class="weui_dialog_alert" id="dialog" style='display:none'>
            <div class="weui_mask"></div>
            <div class="weui_dialog">
                <div class="weui_dialog_hd"><strong class="weui_dialog_title" id='result_head'></strong></div>
                <div class="weui_dialog_bd" id='result_body'></div>
                <div class="weui_dialog_ft">
                    <a class="weui_btn_dialog primary" href="javascript:$('#dialog').hide();">确定</a>
                </div>
            </div>
        </div>
        <div class="weui_loading_toast" id="toast" style="display: none;">
            <div class="weui_mask_transparent"></div>
            <div class="weui_toast">
                <div class="weui_loading">
                    <div class="weui_loading_leaf weui_loading_leaf_0"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_1"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_2"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_3"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_4"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_5"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_6"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_7"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_8"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_9"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_10"></div>
                    <div class="weui_loading_leaf weui_loading_leaf_11"></div>
                </div>
                <p class="weui_toast_content" id='toast_text'></p>
            </div>
        </div>
    </body>
</html>
