<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=0'/>
        <title>体验</title>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/style/weui.min.css'/>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/example/example.css'/>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery-3.0.0.min.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery.json.min.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery.cookie.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/ski.js'></script>
        <script type='text/javascript' src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>
        <script type='text/javascript'>
            var gid = ski.cookie('gid');
            var url_setup = '/ski-wcweb?inst=2001&step=setup';
            var url_apply = '/ski-wcweb?inst=2106&step=apply';

            $(document).ready(function() {
                ski.ui.show_toast('正在加载');
                $.post(url_setup,$.toJSON({
                        'gid'   : gid
                    }),
                    function(args) {
                        ski.ui.hide_toast();
                        if (0 != args.code) {
                            ski.ui.show_dialog_alert({
                                head : "加载失败",
                                body : args.desc
                            });
                            return;
                        }
                        $('#name').text(args.desc.name_zh_cn);

                        if (args.desc.rent_avail_a) $('#type').html("<option value='0'>认证 - " + args.desc.rent_price_a + "元/天</option>");
                        if (args.desc.rent_avail_b) $('#type').append("<option value='1'>不认证 - " + args.desc.rent_price_b + "元/天</option>");
                        if (!args.desc.rent_avail_a && !args.desc.rent_avail_b) $('#rent_begin').hide();
                    });
            });

            function apply() {
                ski.ui.show_toast('正在操作');
                $.post(url_apply, $.toJSON({
                        'gid'   : gid,
                        'type'  : $('#type').val() // hex
                    }), function(args) {
                        ski.ui.hide_toast();
                        if (0 != args.code) {
                            ski.ui.show_dialog_alert({
                                head : '操作失败',
                                body : args.desc
                            });
                            return;
                        }
                        window.location = args.desc;
                    });
            }
        </script>
    </head>
    <body>
        <div class='cell'>
            <div class='hd'>
                <h1 class='page_title'>体验</h1>
            </div>
            <div class='bd'>
                <div class="weui_cells">
                    <div class="weui_cell">
                        <div class="weui_cell_bd weui_cell_primary"><p>游戏名</p></div>
                        <div class="weui_cell_ft" id='name'></div>
                    </div>
                </div>
                <div class="weui_cells_title">
                    体验类型说明：<br/>
                    认证：即认证为常用主机，有奖杯<br/>
                    不认证：即不认证为常用主机，无奖杯
                </div>
                <div class='weui_cells'>
                    <div class="weui_cell weui_cell_select weui_select_after">
                        <div class="weui_cell_hd">
                            <label class="weui_label" for="">体验类型</label>
                        </div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <select name="select" class="weui_select" id='type'></select>
                        </div>
                    </div>
                </div>
                <div class='weui_btn_area' id='rent_begin'>
                    <a class='weui_btn weui_btn_primary' href="javascript:apply();">开始体验</a>
                </div>
            </div>
        </div>
    </body>
</html>
