<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=0'/>
        <title>🔍全搜索</title>
        <link rel='stylesheet' href='/css/weui.css'/>
        <link rel='stylesheet' href='/css/jquery-ui.css'/>
        <link rel='stylesheet' href='/css/theme.css'/>
        <script type='text/javascript' src='/js/jquery.js'></script>
        <script type='text/javascript' src='/js/jquery.json.js'></script>
        <script type='text/javascript' src='/js/jquery.cookie.js'></script>
        <script type='text/javascript' src='/js/jquery-ui.js'></script>
        <script type='text/javascript' src='/js/ski.js'></script>
        <script type='text/javascript'>
        
            $(document).ready(function() {
                setup();
				$('#search_input').bind('focus', function() {
					$('#search_bar').addClass('weui_search_focusing');
				});
				$('#search_input').bind('blur', function() {
					if (0 == $('#search_input').val().length) {
						$('#search_bar').removeClass('weui_search_focusing');
					}
				});

                $('#categories').menu();
            });

            function preset() {
                $('#result').html(
                    "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=tag&val=十佳精彩游戏'>  <img width='100%' src='res/十佳精彩游戏.jpg'/></a></div>"
                  + "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=tag&val=微信ONLY'>      <img width='100%' src='res/微信ONLY.jpg'/></a></div>"
                  + "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=tag&val=大牌游戏'>      <img width='100%' src='res/大牌游戏.jpg'/></a></div>"
                  + "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=tag&val=游戏艺术'>      <img width='100%' src='res/游戏艺术.jpg'/></a></div>"
                  + "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=category&val=动作'>     <img width='100%' src='res/动作游戏.jpg'/></a></div>"
                  + "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=category&val=赛车'>     <img width='100%' src='res/速度与激情.jpg'/></a></div>"
                  + "<div style='margin: 10px; margin-bottom: 0px'><a href='query_game.html?key=category&val=角色扮演'> <img width='100%' src='res/精彩的角色扮演游戏.jpg'/></a></div>"
                );
            }

            function search(word) {
                ski.ui.show_toast('正在搜索');
                ski.common.query_game({word : word}, function(args) {
                    ski.ui.hide_toast();
                    if (0 != args.code) {
                        ski.ui.show_dialog_alert({
                            head : "搜索失败",
                            body : args.desc
                        });
                        return;
                    }
                    var games = args.desc;
                    var title = document.createElement('div');
                    title.className = 'weui_panel_hd';
                    title.innerText = '搜索结果';

                    var cells = document.createElement('div');
                    cells.className = 'weui_panel_bd';
                    for (var i in games) {
                        var game = games[i];
                        var cell = "<a class='weui_media_box weui_media_appmsg' href=\"javascript: ski.goto.game(" + game.gid + ");\">"
                                     + "<div class='weui_media_hd'><img class='weui_media_appmsg_thumb' src='" + game.url_icon + "'></div>"
                                     + "<div class='weui_media_bd'>"
                                        + "<h4 class='weui_media_title'>" + game.name_zh_cn + "</h4>"
                                        + "<p class='weui_media_desc'>" + game.introduction + "</p>"
                                     + "</div>"
                                     + "<div style='position: absolute; width: 70px; top: 20px; right: 20px'><table width='100%'><tr>"
                                         + "<td><div class='" + (game.rent_avail_a ? "rent_enable" : "rent_disable") + "'>认证</div></td>"
                                         + "<td><div class='" + (game.rent_avail_b ? "rent_enable" : "rent_disable") + "'>不认证</div></td>"
                                     + "</tr></table></div>"
                                 + "</a>";
                        cells.innerHTML = cells.innerHTML + cell;
                    }
                    $('#result').html(title);
                    $('#result').append(cells);
                });
            }
			
            function setup() {
                var word   = $('#search_input').val().replace(/(^\s*)|(\s*$)/g, "");

                if (0 == word.length) {
                    preset();
                } else {
                    search(word);
                }
            }
			
			function oncancel() {
				$('#search_input').val('');
				$('#search_input').blur();
				setup();
			}
			
			var toggle_on = false;
			
			function toggle_category() {
				if (toggle_on) {
                    $('.weui_mask_transparent').hide(); 
					$('#categories').animate({opacity : '0', top : '-'+$('#categories').height()+'px'});
					toggle_on = false;
				} else {
                    $('.weui_mask_transparent').show(); 
					$('#categories').css({opacity : 0, top : '-'+$('#categories').height()+'px'});
					$('#categories').animate({opacity : 1, top : ($('#search_bar').outerHeight(true)-1)+'px'});
					toggle_on = true;
				}
			}
			
        </script>
        <style type="text/css">
            td {
                white-space     : nowrap;
            }
            .rent_enable {
                text-align      : center;
                font-size       : 10px;
                color           : white;
                background      : #00C802;
                -webkit-border-radius   : 6px;
                -moz-border-radius      : 6px;
            }
            .rent_disable {
                text-align      : center;
                font-size       : 10px;
                color           : white;
                background      : #B2B2B2;
                -webkit-border-radius   : 6px;
                -moz-border-radius      : 6px;
            }
            .td_cat_h {
                background  : #eeeeee;
                border      : 1px solid darkgray;
            }
            .td_cat_l {
                background  : #dddddd;
                border      : 1px solid darkgray;
            }
            div table tr td a div {
                padding-top     : 8px;
                padding-bottom  : 8px;
                padding-left    : 24px;
                padding-right   : 24px;
                text-align	: center;
            }
            li ul {
                height      : 300px;
                overflow    : auto;
            }
            li div a {
                width       : 100%;
                height      : 100%;
            }
            li div a div {
                width       : 100%;
                height      : 100%;
                white-space : nowrap;
            }
        </style>
    </head>
    <body>
        <div class='panel'>
            <div class='bd'>
                <div class="weui_search_bar" style='position: fixed; z-index: 10; width: 100%; top: 0px; background: lightgray; border-top: 1px solid #aaa; border-bottom: 1px solid #aaa' id="search_bar">
                	<div id='toggle_switch' class='weui_btn weui_btn_mini weui_btn_primary' style='float: left; position: relative; width: 100px; margin-right: 8px; ' onclick="toggle_category();">分类 ▼</div>
                    <div class="weui_search_outer" style='background: lightgray'>
                        <div class="weui_search_inner">
                            <i class="weui_icon_search"></i>
                            <input class="weui_search_input" id='search_input' required type="search" placeholder="搜索" onkeyup="if(13 == event.keyCode) setup();" >
                            <a class="weui_icon_clear" id="search_clear" href="javascript:$('#search_input').val('');$('#search_input').focus();setup();"></a>
                        </div>
                        <label class="weui_search_text" id="search_text" for="search_input">
                            <i class="weui_icon_search"></i>
                            <span>搜索</span>
                        </label>
                    </div>
                   	<a class="weui_search_cancel" id="search_cancel" href="javascript: oncancel();">取消</a>
                </div>
                <div class='weui_mask_transparent' style='z-index: 5; display: none;' onclick="toggle_category()"></div>
                <ul id='categories' style='position: fixed; z-index: 6; left: 0px; top: 9999px;'>
                    <li><div><a href='query_game.html?key=tag&val=最近上新'>     <div>最近上新</div></a></div></li>
                    <li><div><a href='query_game.html?key=tag&val=十佳精彩游戏'> <div>十佳精彩游戏</div></a></div></li>
                    <li><div><a href='query_game.html?key=tag&val=速度与激情'>   <div>速度与激情</div></a></div></li>
                    <li><div><a href='query_game.html?key=tag&val=游戏艺术'>     <div>游戏艺术</div></a></div></li>
                    <li><div>按类型分</div>
                        <ul>
                            <li><div><a href='query_game.html?key=category&val=动作'>       <div>动作</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=射击'>       <div>射击</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=角色扮演'>   <div>角色扮演</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=冒险'>       <div>冒险</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=赛车'>       <div>赛车</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=策略'>       <div>策略</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=格斗'>       <div>格斗</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=益智'>       <div>益智</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=恐怖'>       <div>恐怖</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=模拟'>       <div>模拟</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=休闲'>       <div>休闲</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=音乐'>       <div>音乐</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=其他'>       <div>其他</div></a></div></li>
                            <li><div><a href='query_game.html?key=category&val=体育'>       <div>体育</div></a></div></li>
                        </ul>
                    </li>
                    <li><div>公司作品</div>
                        <ul>
                            <li><div><a href='query_game.html?key=vendor&val=Electronic_Arts'>              <div>EA</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=CAPCOM'>                       <div>CAPCOM(卡普空)</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=Ubisoft_Entertainment'>        <div>Ubisoft(育碧)</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=Bethesda_Softworks'>           <div>Bethesda</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=Naughty_Dog'>                  <div>Naughty Dog(顽皮狗)</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=SQUARE_ENIX'>                  <div>Square-Enix</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=Blizzard_Entertainment'>       <div>Blizzard(动视暴雪)</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=SEGA_Games'>                   <div>SEGA(世嘉)</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=BANDAI_NAMCO_Entertainment'>   <div>BANDAI NAMCO(百代南梦宫)</div></a></div></li>
                            <li><div><a href='query_game.html?key=vendor&val=Konami_Digital'>               <div>KONAMI(柯纳米)</div></a></div></li>
                        </ul>
                    </li>
                    <li><div><a href='query_game.html?key=word&val='>     <div>所有游戏</div></a></div></li>
                </ul>
                <div class="weui_panel weui_panel_access" style='position: relative; top: 34px' id='result'></div>
            </div>
        </div>
    </body>
</html>
