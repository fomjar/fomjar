<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=0'/>
        <title>üïπÊ≠£Âú®Áé©</title>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/style/weui.min.css'/>
        <link rel='stylesheet' href='/ski-wcweb/weui/dist/example/example.css'/>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery-3.0.0.min.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery.json.min.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/jquery.cookie.js'></script>
        <script type='text/javascript' src='/ski-wcweb/lib/ski.js'></script>
        <script type='text/javascript'>
            var url_setup       = '/ski-wcweb?inst=2006&step=setup';
            var url_rent_end    = '/ski-wcweb?inst=2107';
            var url_query_game  = '/ski-wcweb?inst=2001';

            $(document).ready(function() {
                ski.ui.show_toast('Ê≠£Âú®Âä†ËΩΩ');
                $.get(url_setup, function(args) {
                    ski.ui.hide_toast();
                    if (0 != args.code) {
                        ski.ui.show_dialog_alert({
                            head : 'Âä†ËΩΩÂ§±Ë¥•',
                            body : args.desc
                        });
                        return;
                    }
                    for (var i in args.desc) {
                        var commodity = args.desc[i];

                        if ('' == commodity.end) {
                            var cells = document.createElement('div');
                            cells.className = 'weui_cells';
                            cells.innerHTML = "<a class='weui_media_box weui_media_appmsg' href=\"javascript: $('#commodity_" + commodity.oid + "_" + commodity.csn + "').is(':visible') ? $('#commodity_" + commodity.oid + "_" + commodity.csn + "').hide() : $('#commodity_" + commodity.oid + "_" + commodity.csn + "').show()\">"
                                                + "<div class='weui_media_hd'><img class='weui_media_appmsg_thumb' src='" + commodity.game.url_icon + "'></div>"
                                                + "<div class='weui_media_bd'>"
                                                   + "<h4 class='weui_media_title'>" + commodity.game.name_zh_cn + "</h4>"
                                                   + "<p class='weui_media_desc'>"
                                                        + "Â∏êÂè∑ÂØÜÁ†Å: " + commodity.account + " / " + commodity.pass + "<br/>"
                                                        + "ÂºÄÂßãÊó∂Èó¥: " + commodity.begin
                                                   + "</p>"
                                                   + "<div style='position: absolute; bottom: 17px; right: 20px; font-size: 70%; color: gray'>ÁÇπÂáªÂ±ïÂºÄ‚¨áÔ∏é</div>"
                                                + "</div>"
                                            + "</a>";
                            cells.innerHTML += "<div class='weui_cells' style='margin-top: 0px; display: none' id='commodity_" + commodity.oid + "_" + commodity.csn + "'>"
                                                    + "<div class='weui_cell'><div class='weui_cell_bd weui_cell_primary'><p>‰ΩìÈ™åÁ±ªÂûã</p></div><div class='weui_cell_ft'>" + commodity.type + "(" + commodity.price + "ÂÖÉ/Â§©)" +  "</div></div>"
                                                    + "<div class='weui_cell'><div class='weui_cell_bd weui_cell_primary'><p>Ë¥πÁî®Â∞èËÆ°</p></div><div class='weui_cell_ft'>" + commodity.expense + "ÂÖÉ</div></div>"
                                                    + "<div class='weui_cell'><div class='weui_btn_area' style='width: 100%; margin: 0px'>"
                                                        + "<table width='100%'><tr>"
                                                            + "<td style='width: 50%'><a class='weui_btn weui_btn_mini weui_btn_primary' style='width: 100%' href='javascript:browseGame(" + commodity.game.gid + ");'>Êü•ÁúãÊ∏∏Êàè</a></td>"
                                                            + "<td style='width: 50%'><a class='weui_btn weui_btn_mini weui_btn_primary' style='width: 100%' href='javascript:rentEnd(" + commodity.oid + ", " + commodity.csn + ");'>ÊàëË¶ÅÂΩíËøò</a></td>"
                                                        + "</tr></table>"
                                                    + "</div></div>"
                                            + "</div>";

                            $('#result_now').append(cells);
                        } else {
                            var cells = document.createElement('div');
                            cells.className = 'weui_cell';
                            cells.innerHTML = "<a class='weui_media_box weui_media_appmsg' style='width: 100%; padding: 0px' href='javascript:browseGame(" + commodity.game.gid + ");'>"
                                                + "<div class='weui_media_hd'><img class='weui_media_appmsg_thumb' src='" + commodity.game.url_icon + "'></div>"
                                                + "<div class='weui_media_bd'>"
                                                   + "<h4 class='weui_media_title'>" + commodity.game.name_zh_cn + "</h4>"
                                                   + "<p class='weui_media_desc'>"
                                                       + "Êó∂Èó¥: " + commodity.begin.substring(5) + " ~ " + commodity.end.substring(5) + "<br/>"
                                                       + "Ê∂àË¥π: " + commodity.expense + "ÂÖÉ - " + commodity.type + "(" + commodity.price + "ÂÖÉ/Â§©)"
                                                   + "</p>"
                                                + "</div>"
                                            + "</a>";

                            $('#result_old').append(cells);
                        }
                    }
                });
            });

            function rentEnd(oid, csn) {
               window.location = url_rent_end + '&oid=' + oid.toString(16) + '&csn=' + csn.toString(16); 
            }

            function browseGame(gid) {
                window.location = url_query_game + '&gid=' + gid.toString(16);
            }

            function switchToNow() {
                $('#result_now_label').addClass('weui_bar_item_on');
                $('#result_old_label').removeClass('weui_bar_item_on');
                $('#result_now').show();
                $('#result_old').hide();
            }

            function switchToOld() {
                $('#result_now_label').removeClass('weui_bar_item_on');
                $('#result_old_label').addClass('weui_bar_item_on');
                $('#result_now').hide();
                $('#result_old').show();
            }
        </script>
    </head>
    <body>
        <div class='navbar'>
            <div class='bd' style='height: 100%'>
                <div class="weui_tab">
                    <div class="weui_navbar">
                        <div class="weui_navbar_item weui_bar_item_on" id='result_now_label' onclick='switchToNow()'>Ê≠£Âú®Áé©</div>
                        <div class="weui_navbar_item" id='result_old_label' onclick='switchToOld()'>Â∑≤ÂΩíËøò</div>
                    </div>
                    <div class="weui_tab_bd">
                        <div class='weui_panel_bd' id='result_now'></div>
                        <div class='weui_cells' id='result_old' style='display: none'></div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
